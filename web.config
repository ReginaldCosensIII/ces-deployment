<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <system.webServer>

        <!-- Sets the default file to serve when a user visits a directory (e.g., your homepage) -->
        <defaultDocument>
            <files>
                <clear />
                <add value="index.html" />
            </files>
        </defaultDocument>

        <!-- This section handles all URL rewriting and redirection rules. -->
        <rewrite>
            <rules>
                
                <!-- RULE 1: 301 Redirects for Old Pages -->
                <!-- This rule map handles the permanent redirection of old URLs to their new counterparts. -->
                <!-- This is critical for preserving SEO value from the old site. -->
                <rule name="Redirects for old pages" stopProcessing="true">
                    <match url=".*" />
                    <conditions>
                        <add input="{StaticRedirects:{REQUEST_URI}}" pattern="(.+)" />
                    </conditions>
                    <action type="Redirect" url="{C:1}" redirectType="Permanent" />
                </rule>

                <!-- RULE 2: Remove .html extension from URLs -->
                <!-- This rule makes your URLs clean and SEO-friendly (e.g., /about-us instead of /about-us.html). -->
                <rule name="Remove .html extension" stopProcessing="true">
                    <match url="^(.*)$" ignoreCase="false" />
                    <conditions>
                        <add input="{REQUEST_FILENAME}" matchType="IsFile" ignoreCase="false" negate="true" />
                        <add input="{REQUEST_FILENAME}" matchType="IsDirectory" ignoreCase="false" negate="true" />
                        <add input="{REQUEST_FILENAME}.html" matchType="IsFile" />
                    </conditions>
                    <action type="Rewrite" url="{R:1}.html" />
                </rule>

                <!-- RULE 3: Redirect requests for .html pages to clean URLs (with exception for index.html) -->
                <!-- This rule ensures that if someone types in /about-us.html, they are redirected to /about-us. -->
                <rule name="Redirect .html to clean URL" stopProcessing="true">
                    <match url="(.*)\.html$" />
                    <conditions>
                        <!-- This condition prevents the rule from running on index.html -->
                        <add input="{URL}" pattern="^index\.html$" negate="true" />
                    </conditions>
                    <action type="Redirect" url="{R:1}" redirectType="Permanent" />
                </rule>

            </rules>

            <!-- This rewriteMap contains our 301 redirect mapping. -->
            <!-- It's a clean way to manage all your redirects in one place. -->
            <rewriteMaps>
                <rewriteMap name="StaticRedirects">
                    <!-- Direct Matches -->
                    <add key="/ManagedServices.htm" value="/managed-services.html" />
                    <add key="/products-cameras.htm" value="/video-surveillance.html" />
                    <add key="/Testimonials.htm" value="/testimonials.html" />
                    <add key="/LocationHoursContact.htm" value="/contact-us.html" />
                    <add key="/About.htm" value="/about-us.html" />

                    <!-- Consolidated Services to Managed Services -->
                    <add key="/OnsiteService.htm" value="/managed-services.html" />
                    <add key="/Diagnostics&amp;Repair.htm" value="/managed-services.html" />
                    <add key="/Networks.htm" value="/managed-services.html" />
                    <add key="/products-SANs.htm" value="/managed-services.html" />
                    <add key="/Cloud.htm" value="/managed-services.html" />
                    <add key="/WhatIsACloud.htm" value="/managed-services.html" />
                    <add key="/SoftwareSolutions.htm" value="/managed-services.html" />
                    <add key="/ForensicAnalysis.htm" value="/managed-services.html" />
                    <add key="/DataRecovery.htm" value="/managed-services.html" />
                    <add key="/DisasterRecovery.htm" value="/managed-services.html" />
                    <add key="/OffSiteBackup.htm" value="/managed-services.html" />
                    <add key="/Database.htm" value="/managed-services.html" />

                    <!-- Redirects to Homepage -->
                    <add key="/home.htm" value="/index.html" />
                    <add key="/products-smartboards.htm" value="/index.html" />
                    <add key="/Blog/" value="/index.html" />
                    <add key="/Client/Servicecall.htm" value="/index.html" /> <!-- No new equivalent, redirect to home -->

                    <!-- Contact Form Redirects -->
                    <add key="/Client/Checkform.html" value="/book-call-form.html" />
                    <add key="/Client/CSPSForm.html" value="/scan-request-form.html" />
                    <add key="/contactform.htm" value="/contact-us.html" />
                </rewriteMap>
            </rewriteMaps>
        </rewrite>

        <!-- Prevents users from being able to see a list of files in a directory if no default document is found. -->
        <directoryBrowse enabled="false" />

    </system.webServer>
</configuration>